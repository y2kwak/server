--echo # Testing JSON escaping in optimizer trace output

#
# MDEV-30354: Fix JSON escaping in optimizer trace output
#

set optimizer_trace="enabled=on";

--echo # Test 1: Simple double quotes
SELECT LENGTH("a");
SELECT json_valid(trace) AS valid_json, trace FROM information_schema.optimizer_trace;

--echo # Test 2: Nested quotes
SELECT LENGTH("a\"b");
SELECT json_valid(trace) AS valid_json, trace FROM information_schema.optimizer_trace;

--echo # Test 3: Special characters with quotes
SELECT LENGTH("a\n\"b\t\"c");
SELECT json_valid(trace) AS valid_json, trace FROM information_schema.optimizer_trace;

--echo # Test 4: New line
SELECT COLUMN_JSON(COLUMN_CREATE("foo", "New
line" AS CHAR));
SELECT json_valid(trace) AS valid_json, trace FROM information_schema.optimizer_trace;

--echo # Test 5: Backslashes
SELECT LENGTH("a\\b");
SELECT json_valid(trace) AS valid_json, trace FROM information_schema.optimizer_trace;

--echo # Test 6: JSON functions
SELECT JSON_EXTRACT('{"key":"value"}', "$.key");
SELECT json_valid(trace) AS valid_json, trace FROM information_schema.optimizer_trace;
